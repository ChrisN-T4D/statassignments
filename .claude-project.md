# Methods Market - Project Documentation

## Project Overview

Research methods modules, statistics support, and software how-tos for psychology. A Vue 3 + PocketBase web application with pseudonymous student tracking. Supports multiple classes (PSYC 4213 Statistics, PSYC 4223 Research Methods) with software-specific content (jamovi, SPSS, R, Stata, Excel).

**Live Backend:** `https://pb.c.robpneu.com`
**Admin UI:** `https://pb.c.robpneu.com/_/`

## Architecture Overview

### Technology Stack
- **Frontend:** Vue 3 (Composition API) + Vite + Vue Router
- **Backend:** PocketBase (SQLite + realtime subscriptions)
- **Auth:** PocketBase built-in (email/password)
- **UI Components:** Custom components + Vuedraggable
- **Deployment:** Docker (Portainer) for backend

### Key Design Patterns
1. **Pseudonymous Tracking:** Students identified by `student_key` (e.g., "SP2025-X7K9M2"), not PII
2. **Sequential Unlock System:** Students must complete items in order
3. **Mastery-Based Learning:** Curated problem sets (2 easy, 2 medium, 2 hard)
4. **Slug-Based Routing:** Clean URLs like `/class/statistics` instead of database IDs
5. **Software-Specific Content:** Modules tagged for jamovi, SPSS, R, Stata, Excel, or "all"

## PocketBase Collections

### Core Collections

#### `classes`
Course organization for different psychology classes.

**Fields:**
- `semester` (relation â†’ semesters, required)
- `code` (text, required) - e.g., "PSYC 4213"
- `name` (text, required) - e.g., "Statistics"
- `slug` (text, required, pattern: `^[a-z0-9-]+$`) - for URLs, e.g., "statistics"
- `description` (text)
- `instructor` (relation â†’ users)
- `is_active` (bool)

**Current Classes:**
- PSYC 4213 - Statistics (slug: `statistics`)
- PSYC 4223 - Research Methods (slug: `research-methods`)
- Intro to Research
- Statistics for Assessment

#### `semesters`
Academic periods.

**Fields:**
- `code` (text, required) - e.g., "2026SP"
- `name` (text, required) - e.g., "Spring 2026"
- `start_date` (date)
- `end_date` (date)
- `is_active` (bool)

**API Rules:**
- List: Public (`""`)
- View: Public (`""`)

#### `modules`
Content modules organized by topic and class.

**Fields:**
- `class` (relation â†’ classes) - NEW: links module to specific class
- `topic_id` (text, required) - e.g., "correlation"
- `title` (text, required)
- `description` (text)
- `order` (number)
- `software_type` (text) - "jamovi", "spss", "r", "stata", "excel", or "all"
- `semester` (relation â†’ semesters) - can be empty for "available to all"

**Current State:**
- 23 modules total
  - 11 modules linked to PSYC 4213 (Statistics)
  - 12 modules linked to PSYC 4223 (Research Methods)

#### `items`
Individual practice problems/questions within modules.

**Fields:**
- `module` (relation â†’ modules, required)
- `title` (text, required)
- `description` (text)
- `type` (text) - "multiple-choice", "text-input", "file-upload", etc.
- `difficulty` (text) - "easy", "medium", "hard"
- `options` (json) - question-specific data
- `tags` (json) - for filtering/organization
- `order` (number)

**Current State:**
- 23 items total across all modules

#### `roster`
Maps student accounts to pseudonymous student keys.

**Fields:**
- `semester` (relation â†’ semesters, required)
- `student_key` (text, required, unique) - e.g., "SP2025-X7K9M2"
- `user` (relation â†’ users) - linked when student claims key
- `first_name` (text, required)
- `last_name` (text, required)
- `blackboard_username` (text) - from Blackboard export
- `claimed_at` (datetime)

**Privacy Design:**
- `student_key` is the ONLY identifier in exports
- First/last names stored ONLY for roster verification
- All analytics use `student_key`, never PII

#### `attempts`
Student practice attempt records.

**Fields:**
- `student_key` (text, required, indexed)
- `user` (relation â†’ users) - redundant with student_key for queries
- `module` (relation â†’ modules, required)
- `item` (relation â†’ items, required)
- `semester` (relation â†’ semesters, required)
- `is_correct` (bool, required)
- `attempt_data` (json) - student's response data
- `completed_at` (datetime)

**Indexes:**
- `student_key` for fast filtering
- Composite indexes for analytics queries

#### `users`
Built-in PocketBase collection for authentication.

**Custom Fields:**
- `role` (text) - "student" or "instructor"
- `name` (text)

**Auth:**
- Email/password authentication
- Students must claim roster entry via student key

### Topics Structure

Topics organize modules into logical learning units. Topics are defined in frontend constants.

**Available Topics (30+):**
- Sampling (sampling)
- Hypothesis Testing (hypothesis-testing)
- Correlation (correlation)
- Descriptive Statistics (descriptive-stats)
- Visualizations (visualizations)
- Normal Distribution (normal-distribution)
- Z-Scores (z-scores)
- T-Tests (t-tests)
- Regression (regression)
- Probability (probability)
- Chi-Square (chi-square)
- ANOVA (anova)
- And more...

### Software Packages

Content can be tagged for specific software packages:

**Supported Packages:**
1. **jamovi** - Free, open-source, GUI-based
2. **SPSS** - Commercial statistical software
3. **R** - Programming language for statistics
4. **Stata** - Commercial stats software
5. **Excel** - Microsoft spreadsheet with analysis tools
6. **all** - Content applicable to all software types

## Project Structure

```
statassignments/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ClassHeader.vue              # Class navigation header
â”‚   â”‚   â”œâ”€â”€ ClassSelector.vue            # Dropdown for class selection
â”‚   â”‚   â”œâ”€â”€ ModuleItem.vue               # Individual module display
â”‚   â”‚   â”œâ”€â”€ PracticeItem.vue             # Practice question display
â”‚   â”‚   â”œâ”€â”€ ProgressTracker.vue          # Student progress visualization
â”‚   â”‚   â”œâ”€â”€ RosterUpload.vue             # CSV roster import
â”‚   â”‚   â”œâ”€â”€ SoftwareInstructions/
â”‚   â”‚   â”‚   â”œâ”€â”€ JamoviInstructions.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ SPSSInstructions.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ RInstructions.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ StataInstructions.vue
â”‚   â”‚   â”‚   â””â”€â”€ ExcelInstructions.vue
â”‚   â”‚   â””â”€â”€ TopicCard.vue                # Topic selection card
â”‚   â”‚
â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”œâ”€â”€ useAuth.js                   # Authentication logic
â”‚   â”‚   â”œâ”€â”€ useClasses.js                # Class fetching & selection (slug support)
â”‚   â”‚   â”œâ”€â”€ useModules.js                # Module/item fetching & filtering
â”‚   â”‚   â”œâ”€â”€ useAttempts.js               # Attempt logging & progress tracking
â”‚   â”‚   â”œâ”€â”€ useProfile.js                # Student profile claiming
â”‚   â”‚   â””â”€â”€ useInstructorAnalytics.js    # CSV exports & roster management
â”‚   â”‚
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”œâ”€â”€ Home.vue                     # Landing page
â”‚   â”‚   â”œâ”€â”€ Auth.vue                     # Login/signup
â”‚   â”‚   â”œâ”€â”€ ClaimProfile.vue             # Claim student key
â”‚   â”‚   â”œâ”€â”€ ClassHome.vue                # Class overview (topics list)
â”‚   â”‚   â”œâ”€â”€ TopicView.vue                # Topic modules list
â”‚   â”‚   â”œâ”€â”€ ModuleView.vue               # Module practice interface
â”‚   â”‚   â”œâ”€â”€ Practice.vue                 # General practice (random/by topic)
â”‚   â”‚   â”œâ”€â”€ Profile.vue                  # Student progress dashboard
â”‚   â”‚   â””â”€â”€ InstructorDashboard.vue      # Analytics & roster management
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ pocketbase.js                # PocketBase client instance
â”‚   â”‚
â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â””â”€â”€ index.js                     # Vue Router configuration
â”‚   â”‚
â”‚   â””â”€â”€ App.vue                          # Root component
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ topics.js                        # Topic definitions
â”‚   â”œâ”€â”€ modules.js                       # Module seed data
â”‚   â”œâ”€â”€ software-instructions.js         # Software-specific instructions
â”‚   â””â”€â”€ classes.js                       # Class definitions
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ import-seed-data.js              # Import semesters/modules/items
â”‚   â”œâ”€â”€ setup-classes.js                 # Create classes & link modules
â”‚   â”œâ”€â”€ add-class-slugs.js               # Add slug field to classes
â”‚   â”œâ”€â”€ import-classes.js                # Import classes from JSON
â”‚   â”œâ”€â”€ test-connection.js               # Verify PocketBase connection
â”‚   â””â”€â”€ classes-seed-data.json           # Class seed data
â”‚
â”œâ”€â”€ pocketbase-schema.json               # Complete PB schema definition
â”œâ”€â”€ pocketbase-schema.md                 # Human-readable schema docs
â”œâ”€â”€ SETUP.md                             # Detailed setup guide
â”œâ”€â”€ QUICK-FIX.md                         # Common issues & fixes
â”œâ”€â”€ MANUAL-IMPORT-GUIDE.md               # Fallback manual import steps
â””â”€â”€ README.md                            # Quick start guide
```

## Routing Structure

### Public Routes
- `/` - Home (landing page)
- `/auth` - Login/signup
- `/claim` - Claim student key

### Student Routes (requires auth)
- `/profile` - Student progress dashboard
- `/class/:classId` - Class home (topics list) - supports slug or ID
  - Example: `/class/statistics` or `/class/<database-id>`
- `/class/:classId/topic/:topicId` - Topic modules list
- `/class/:classId/module/:moduleId` - Module practice interface
- `/practice` - General practice (random/by topic)

### Instructor Routes (requires `role: "instructor"`)
- `/instructor` - Analytics dashboard & roster management

### Navigation Guards

**Auth Guard:**
```javascript
// Protects routes requiring authentication
if (to.meta.requiresAuth && !authStore.user) {
  return '/auth'
}
```

**Instructor Guard:**
```javascript
// Protects instructor-only routes
if (to.meta.requiresInstructor && authStore.user?.role !== 'instructor') {
  return '/'
}
```

## Key Composables

### useClasses.js
Manages class selection and fetching.

**State:**
- `classes` - Active classes list
- `selectedClassId` - Current selected class (persisted to localStorage)
- `selectedClass` - Computed class object
- `classTopics` - Topics for selected class

**Methods:**
- `fetchClasses()` - Get all classes from PocketBase
- `getClassById(id)` - Get single class by ID
- `getClassBySlug(slug)` - Get single class by slug (NEW)
- `selectClass(id)` - Set selected class
- `syncWithRoute()` - Sync selection with URL params (supports slug or ID)
- `navigateToClass(idOrSlug)` - Navigate to class (uses slug in URL if available)

**Slug Support:**
- URLs use slugs: `/class/statistics` instead of `/class/<database-id>`
- Falls back to ID if slug not available
- `syncWithRoute()` tries slug lookup first, then ID

### useModules.js
Fetches modules and items with filtering.

**State:**
- `modules` - Current modules list
- `items` - Current items list
- `loading` - Loading state

**Methods:**
- `fetchModules(classId, softwareType, semesterId)` - Get filtered modules
- `fetchItems(moduleId)` - Get items for a module
- `fetchItemsByTopic(topicId, softwareType)` - Get items across topic's modules
- `fetchRandomItem(topicId, softwareType)` - Get random item for practice
- `fetchNextItem(moduleId, completedItemIds)` - Get next unlocked item
- `getItemsWithUnlockStatus(items, completedItemIds)` - Add unlock/completed flags

**Filtering:**
- By class ID
- By software type ("jamovi", "spss", "r", "stata", "excel", "all")
- By semester ID (or empty for "all semesters")

### useAttempts.js
Logs student attempts and tracks progress.

**Methods:**
- `logAttempt(itemId, moduleId, isCorrect, attemptData)` - Record attempt
- `getModuleProgress(moduleId)` - Get completed item IDs for a module
- `getTopicProgress(topicId, softwareType)` - Get topic completion stats
- `getUserStats()` - Get overall user statistics

**Progress Calculation:**
- Counts items completed correctly (first correct attempt)
- Sequential unlock: next item unlocked when previous completed
- Tracks attempts per item for mastery metrics

### useInstructorAnalytics.js
Instructor-only features for roster management and analytics.

**Roster Management:**
- `uploadRoster(csvFile, semesterId)` - Import Blackboard CSV
- `generateStudentKeys()` - Create pseudonymous keys
- `downloadRosterCSV()` - Export roster with student keys

**Analytics:**
- `exportAttemptLevelCSV(semesterId)` - Attempt-by-attempt data
- `exportStudentSummaryCSV(semesterId)` - Per-student summary stats

**CSV Export Fields:**

*Attempt-Level:*
- student_key
- module_title
- item_title
- is_correct
- completed_at

*Student Summary:*
- student_key
- total_attempts
- correct_attempts
- accuracy_rate
- modules_started
- modules_completed

### useAuth.js
Authentication and user management.

**State:**
- `user` - Current user object
- `isAuthenticated` - Boolean auth status

**Methods:**
- `login(email, password)` - Authenticate user
- `signup(email, password, name)` - Create new account
- `logout()` - Clear session
- `updateProfile(data)` - Update user fields

### useProfile.js
Student key claiming.

**Methods:**
- `claimStudentKey(studentKey)` - Link current user to roster entry
- `getClaimedProfile()` - Get roster entry for current user
- `isKeyClaimed(studentKey)` - Check if key already claimed

**Claim Flow:**
1. Student creates account (`useAuth.signup()`)
2. Student receives student key from instructor
3. Student enters key at `/claim`
4. System links `user` to `roster` entry
5. All future attempts tagged with `student_key`

## Admin Authentication

**Important:** PocketBase admin uses non-standard endpoint.

**Correct Admin Auth:**
```javascript
await pb.collection('_superusers').authWithPassword(email, password)
```

**NOT:**
```javascript
// These don't work:
await pb.admins.authWithPassword(email, password)  // âŒ
await pb.collection('admins').authWithPassword(email, password)  // âŒ
```

**Admin UI:** `https://pb.c.robpneu.com/_/`

## Setup Scripts

### import-seed-data.js
Imports initial data into PocketBase.

**Imports:**
- Semesters (2026SP - Spring 2026)
- Modules (11 modules for various topics)
- Items (23 practice questions)

**Usage:**
```bash
export PB_ADMIN_EMAIL="your-admin@email.com"
export PB_ADMIN_PASSWORD="your-password"
node import-seed-data.js
```

**Status:** âœ… Complete (1 semester, 11 Statistics modules, 23 items imported)

### setup-classes.js
Complete automated setup of classes collection.

**Actions:**
1. Creates `classes` collection with proper schema
2. Adds `class` relation field to `modules` collection
3. Creates PSYC 4213 (Statistics) and PSYC 4223 (Research Methods)
4. Links all existing modules to PSYC 4213

**Usage:**
```bash
node setup-classes.js
```

**Status:** âœ… Complete (2 classes created, 11 modules linked to PSYC 4213, 12 modules linked to PSYC 4223)

### add-class-slugs.js
Adds slug field to classes for friendly URLs.

**Actions:**
1. Adds `slug` field to `classes` collection
2. Updates PSYC 4213 with slug: `statistics`
3. Updates PSYC 4223 with slug: `research-methods`

**Usage:**
```bash
node add-class-slugs.js
```

**Status:** âœ… Complete (slug field added, classes updated)

### import-research-methods-modules.js
Imports 12 Research Methods modules and links them to PSYC 4223.

**Imports:**
- 12 Research Methods modules covering:
  1. Research Thinking: Biases, Theories, and Hypotheses
  2. From Ideas to Articles: Literature Search and Question Refinement
  3. Research Design Logic: Correlation, Causation, and Validity
  4. Ethics and Human Subjects: Consent, Risk, and IRB Basics
  5. Measurement Foundations: Reliability, Validity, and Scale Quality
  6. Survey Research: Item Writing, Formats, and Online Tools
  7. Correlational and Group-Comparison Designs
  8. Qualitative Research: Interviews, Coding, and Trustworthiness
  9. Between-Subjects Experiments: Manipulation, Control, and Inference
  10. Within-Subjects Designs: Counterbalancing and Repeated Measures
  11. Sampling and Recruiting Participants: Field and Online Strategies
  12. Bringing It Together: Applied Decisions and Research Integration

**Usage:**
```bash
node import-research-methods-modules.js
```

**Status:** âœ… Complete (12 modules created and linked to PSYC 4223)

### test-connection.js
Verifies PocketBase connection and data.

**Checks:**
- API health
- Collection existence
- Data counts

**Usage:**
```bash
node test-connection.js
```

**Expected Output:**
```
âœ“ Health check: API is healthy.
âœ“ Collection 'semesters' exists
âœ“ Collection 'modules' exists
âœ“ Collection 'items' exists
âœ“ Collection 'attempts' exists
âœ“ Collection 'roster' exists

Semesters: 1 found
  - 2026SP (Spring 2026) [ACTIVE]

Modules: 23 found (11 Statistics + 12 Research Methods)
Items: 23 total
```

## Current State & Known Issues

### Completed âœ…
- PocketBase backend deployed and running
- All collections created with proper schemas
- Classes collection with slug support
- Slug-based routing in frontend
- Seed data imported (1 semester, 23 modules, 23 items)
- 2 classes created: PSYC 4213 (Statistics), PSYC 4223 (Research Methods)
- Statistics class: 11 modules (covering descriptive stats, visualization, probability, hypothesis testing, t-tests, correlation, regression)
- Research Methods class: 12 modules (covering research thinking, literature search, design logic, ethics, measurement, surveys, experiments, qualitative methods, sampling)
- Slug-based URLs working: `/class/statistics` and `/class/research-methods`

### Pending ğŸš§
1. **Items/Questions:** Need to create practice items for Research Methods modules
   - Currently only Statistics modules have items
   - Should add relevant questions for each RM module topic

### Known Issues
1. **Admin Auth Endpoint:** Must use `_superusers` collection, not standard `/api/admins`
2. **PocketBase API:** Uses `fields` array, not `schema` array for collection definitions
3. **Test Script:** Shows 0 modules/items when run without authentication

## Development Workflow

### Running Locally
```bash
# Install dependencies
npm install

# Run dev server
npm run dev

# Visit
http://localhost:5173
```

### Modifying PocketBase Schema
1. Make changes via Admin UI: `https://pb.c.robpneu.com/_/`
2. Export schema: Collections â†’ Export
3. Update `pocketbase-schema.json`
4. Document changes in this file

### Adding New Classes
1. Create class record in PocketBase Admin UI
2. Add slug following pattern: `^[a-z0-9-]+$`
3. Link modules to new class via `class` relation field
4. Update frontend route structure if needed

### Adding New Modules
1. Create module record in PocketBase
2. Set `class` relation to appropriate class
3. Set `topic_id` to match topic constant
4. Set `software_type` (jamovi/spss/r/stata/excel/all)
5. Add items linked to the module

### Creating Roster for New Semester
1. Create semester in PocketBase
2. Export Blackboard roster as CSV
3. Upload via `/instructor` interface
4. Download student keys CSV
5. Distribute keys to students

## Privacy & Data Protection

### Pseudonymous Design
- **Student Key Format:** `{SEMESTER}-{RANDOM}` (e.g., "SP2025-X7K9M2")
- **Analytics Exports:** Only include `student_key`, never names or emails
- **Roster Storage:** Names stored ONLY for verification during claiming
- **Attempt Records:** Tagged with `student_key` and `user` ID

### Data Minimization
- PII (names, emails) never in analytics exports
- Student key can't be reverse-engineered to identity
- Instructor sees aggregate stats or pseudonymous data only

## Future Enhancements

### Potential Features
- [ ] Real-time progress updates (PocketBase subscriptions)
- [ ] Peer comparison (anonymized percentile rankings)
- [ ] Adaptive difficulty (recommend next topics based on performance)
- [ ] Rich text explanations for answers
- [ ] Video tutorials linked to modules
- [ ] Gamification (badges, streaks, leaderboards)
- [ ] Mobile app (via Vue mobile framework)

### Technical Debt
- Add comprehensive test suite
- Add TypeScript for type safety
- Implement error boundaries in Vue components
- Add loading states throughout UI
- Improve CSV parsing error handling
- Add data validation on roster import

## Resources

### Documentation
- [Vue 3 Docs](https://vuejs.org/)
- [PocketBase Docs](https://pocketbase.io/docs/)
- [Vue Router Docs](https://router.vuejs.org/)

### Project Files
- [README.md](README.md) - Quick start
- [SETUP.md](SETUP.md) - Detailed setup
- [QUICK-FIX.md](QUICK-FIX.md) - Common issues
- [pocketbase-schema.md](pocketbase-schema.md) - Schema reference

### Admin Access
- **URL:** `https://pb.c.robpneu.com/_/`
- **Auth:** Use `_superusers` collection endpoint

---

**Last Updated:** 2026-01-26
**Project Status:** Active Development
